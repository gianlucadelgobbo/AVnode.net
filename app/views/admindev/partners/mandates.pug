extends ../layout_admin
block content
  include submenu
  if data.length
    - var conta = 1
    - var pl_index
    each item, index in data
      if owner==item._id
        - pl_index = index

    each item, index in data
      if owner!=item._id
        - conta++
        .pt-3.pr-3.pb-3.pl-3.page-break-after-always
          .text-right!="P"+conta
          p!= "I, the undersigned, "
          p
            != (item.organizationData.legal_representative && item.organizationData.legal_representative.name ? item.organizationData.legal_representative.name : "<span class='badge badge-danger'>MISSING legal_representative.name</span>")
            != " "
            != (item.organizationData.legal_representative && item.organizationData.legal_representative.surname ? item.organizationData.legal_representative.surname : "<span class='badge badge-danger'>MISSING legal_representative.surname</span>")
          p!= " representing, "
          p
            != (item.organizationData.legal_name ? item.organizationData.legal_name : "<span class='badge badge-danger'>MISSING legal_name</span>")
            != "<br>"
            != (item.organizationData.type ? item.organizationData.type : "<span class='badge badge-danger'>MISSING type</span>")
            != "<br>"
            != (item.organizationData.official_registration_number ? item.organizationData.official_registration_number : "<span class='badge badge-danger'>MISSING official_registration_number</span>")
            != "<br>"
            != (item.organizationData.address && item.organizationData.address.route ? item.organizationData.address.route : "<span class='badge badge-danger'>MISSING</span>")
            != " "
            != (item.organizationData.address && item.organizationData.address.postal_code ? item.organizationData.address.postal_code : "<span class='badge badge-danger'>MISSING</span>")
            != " "
            != (item.organizationData.address && item.organizationData.address.locality ? item.organizationData.address.locality : "<span class='badge badge-danger'>MISSING</span>")
            != " "
            != (item.organizationData.address && item.organizationData.address.country ? item.organizationData.address.country : "<span class='badge badge-danger'>MISSING</span>")
            if item.organizationData.vat_number
              != "<br>"
              != (item.organizationData.vat_number ? item.organizationData.vat_number : "<span class='badge badge-danger'>MISSING</span>")
          p!= "‘the beneficiary’, "
          p
            != "for the purposes of signing and implementing the grant agreement"
            != " "
            != event_title
            != " "
            != "(hereinafter referred to as \"the grant agreement\") with the Education, Audiovisual and Culture Executive Agency (hereinafter referred to as \"the Agency\") for the action entitled ‘Support for European Cooperation projects 2020' (‘the action’)"
          p!= "hereby:"
          p!= "1. Mandate"
          p
            != (data[pl_index].organizationData.legal_name ? data[pl_index].organizationData.legal_name : "<span class='badge badge-danger'>MISSING legal_name</span>")
            != "<br>"
            != (data[pl_index].organizationData.type ? data[pl_index].organizationData.type : "<span class='badge badge-danger'>MISSING type</span>")
            if item.organizationData.official_registration_number
              != "<br>"
              != (data[pl_index].organizationData.official_registration_number ? data[pl_index].organizationData.official_registration_number : "<span class='badge badge-danger'>MISSING official_registration_number</span>")
            != "<br>"
            != (data[pl_index].organizationData.address && data[pl_index].organizationData.address.route ? data[pl_index].organizationData.address.route : "<span class='badge badge-danger'>MISSING</span>")
            != " "
            != (data[pl_index].organizationData.address && data[pl_index].organizationData.address.postal_code ? data[pl_index].organizationData.address.postal_code : "<span class='badge badge-danger'>MISSING</span>")
            != " "
            != (data[pl_index].organizationData.address && data[pl_index].organizationData.address.locality ? data[pl_index].organizationData.address.locality : "<span class='badge badge-danger'>MISSING</span>")
            != " "
            != (data[pl_index].organizationData.address && data[pl_index].organizationData.address.country ? data[pl_index].organizationData.address.country : "<span class='badge badge-danger'>MISSING</span>")
            != "<br>"
            != (data[pl_index].organizationData.vat_number ? data[pl_index].organizationData.vat_number : "<span class='badge badge-danger'>MISSING</span>")
          p
            != "represented by "
            != (data[pl_index].organizationData.legal_representative && data[pl_index].organizationData.legal_representative.name ? data[pl_index].organizationData.legal_representative.name : "<span class='badge badge-danger'>MISSING legal_representative.name</span>")
            != " "
            != (data[pl_index].organizationData.legal_representative && data[pl_index].organizationData.legal_representative.surname ? data[pl_index].organizationData.legal_representative.surname : "<span class='badge badge-danger'>MISSING legal_representative.surname</span>")
            != " (‘the coordinator’)"
          p!= "to sign in my name and on my behalf the grant agreement and its possible subsequent amendments with the Agency."
          p!= "2. Mandate the coordinator to act on behalf of the beneficiary in compliance with the grant agreement."
          p!= "I hereby confirm that the beneficiary accepts all terms and conditions of the grant agreement and, in particular, all provisions affecting the coordinator and the other beneficiaries. In particular, I acknowledge that, by virtue of this mandate, the coordinator alone is entitled to receive funds from the Agency and distribute the amounts corresponding to the beneficiary’s participation in the action."
          p!= "I hereby accept that the beneficiary will do everything in its power to help the coordinator fulfil its obligations under the grant agreement, and in particular, to provide to the coordinator, on its request, whatever documents or information may be required."
          p!= "I hereby declare that the beneficiary agrees that the provisions of the grant agreement, including this mandate, take precedence over any other agreement between the beneficiary and the coordinator which may have an effect on the implementation of the grant agreement."
          p!= "This mandate is annexed to the grant agreement and forms an integral part of it."
          != "<br>"
          p
            != "SIGNATURE"
            != "<br>"
            != (item.organizationData.legal_representative && item.organizationData.legal_representative.name ? item.organizationData.legal_representative.name : "<span class='badge badge-danger'>MISSING legal_representative.name</span>")
            != " "
            != (item.organizationData.legal_representative && item.organizationData.legal_representative.surname ? item.organizationData.legal_representative.surname : "<span class='badge badge-danger'>MISSING legal_representative.surname</span>")
            != "<br>"
            != (item.organizationData.legal_representative && item.organizationData.legal_representative.role ? item.organizationData.legal_representative.role : "<span class='badge badge-danger'>MISSING legal_representative.surname</span>")

          p!= "Done at "
          p
            != (item.organizationData.address && item.organizationData.address.locality ? item.organizationData.address.locality : "<span class='badge badge-danger'>MISSING</span>")
            != " "
            != (item.organizationData.address && item.organizationData.address.country ? item.organizationData.address.country : "<span class='badge badge-danger'>MISSING</span>")
            != ", "
            - var now = new Date()
            != now.getDate()
            != " "
            - var month = new Array();
            - month[0] = "January";
            - month[1] = "February";
            - month[2] = "March";
            - month[3] = "April";
            - month[4] = "May";
            - month[5] = "June";
            - month[6] = "July";
            - month[7] = "August";
            - month[pl_index] = "September";
            - month[9] = "October";
            - month[10] = "November";
            - month[11] = "December";
            != month[now.getMonth()]
            != " "
            != now.getFullYear()
          != "<br>"
          != "<br>"
          != "<br>"
          != "<br>"




  // Modal Add Partner
  //#modalAddPartner.modal.fade(tabindex='-1', role='dialog', aria-spanledby='modalAddPartnerspan', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        form
          input(type='hidden', name="partner_owner", value=owner)
          //input(type='hidden', name="delegate", value=user.name)
          .modal-header
            h5#modalAddPartnerspan.modal-title=global.__("Add partner")
            button.close(type='button', data-dismiss='modal', aria-span='Close')
              span(aria-hidden='true') ×
          .modal-body
            .alert.d-none
            .form-group
              span(for='formPartnerAddName')=global.__("Brand")
              input#formPartnerAddName.form-control(type='text', name="stagename", placeholder='')
            .form-group
              span(for='formPartnerAddSurname')=global.__("Web channels")
                !=" "
                small=global.__("one per line")
              textarea#formPartnerAddSurname.form-control(name="web")
            .form-group
              span(for='formPartnerAddSurname')=global.__("Social channels")
                !=" "
                small=global.__("one per line")
              textarea#formPartnerAddSurname.form-control(name="social")

          .modal-footer
            button.btn.btn-secondary(type='button', data-dismiss='modal')=global.__("Close")
            button.btn.btn-primary(type='submit')=global.__("Save")
  
  // Modal Link Partner
  //#modalLinkPartner.modal.fade(tabindex='-1', role='dialog', aria-spanledby='modalLinkPartnerspan', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        form
          input(type='hidden', name="partner_owner", value=owner)
          //input(type='hidden', name="delegate", value=user.name)
          input(type='hidden', name="id")
          .modal-header
            h5#modalAddPartnerspan.modal-title=global.__("Add partner")
            button.close(type='button', data-dismiss='modal', aria-span='Close')
              span(aria-hidden='true') ×
          .modal-body
            .alert.d-none
            .form-group
              span(for='formPartnerLinkName')=global.__("Brand")
              input#formPartnerLinkName.form-control(type='text', name="brand", placeholder='')

          .modal-footer
            button.btn.btn-secondary(type='button', data-dismiss='modal')=global.__("Close")
            button.btn.btn-primary(type='submit')=global.__("Save")

  // Modal Add Contact
  //#modalAddContact.modal.fade(tabindex='-1', role='dialog', aria-spanledby='modalAddContactspan', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        form
          .modal-header
            h5#modalAddPartnerspan.modal-title=global.__("Add contact")
            button.close(type='button', data-dismiss='modal', aria-span='Close')
              span(aria-hidden='true') ×
          .modal-body
              .form-group
                input.modal-id(type='hidden', name="crew")
                span(for='formContactAddName')=global.__("Name")
                input#formContactAddName.form-control(type='text', name="name", placeholder='')
              .form-group
                span(for='formContactAddSurname')=global.__("Surname")
                input#formContactAddSurname.form-control(type='text', name="surname", placeholder='')
              .form-group
                span(for='formContactAddEmail')=global.__("Email")
                input#formContactAddEmail.form-control(type='email', name="email", placeholder='name@example.com')
              .form-group
                span(for='formContactAddMobile')=global.__("Mobile")
                input#formContactAddMobile.form-control(type='text', name="mobile", placeholder='')
              .form-group
                span(for='formContactAddFacebook')="Facebook"
                input#formContactAddFacebook.form-control(type='text', name="facebook", placeholder='')
              .form-group
                span(for='formContactAddType')=global.__("Type")
                select#formContactAddType.form-control(name="type")
                  option=global.__("Contact")
                  option=global.__("Legal Rapresentative")

          .modal-footer
            button.btn.btn-secondary(type='button', data-dismiss='modal')=global.__("Close")
            button.btn.btn-primary(type='submit')=global.__("Save")

