extends ../layout_admin
block content
  form.form-inline
    //select.form-control.mb-3.mr-sm-2( onchange="if (this.value) window.location.href='/admindev/partners/"+owner+"/'+this.value")
      option(value=0)=global.__("Filter by event")
      each item, index in events
        option(value=item._id, selected=item._id==event ? "selected" : undefined)=item.title
    if event
      a.btn.btn-primary.mb-3.mr-2(href="/admindev/partners/"+owner+"/"+event+"/manage")=global.__("Manage event partnerships types")
    button.btn.btn-primary.form-control.mb-3.mr-2(type='button', data-toggle='modal', data-target='#modalLinkPartner', data-owner=owner)="ADD"
  table.table
    thead
      tr
        td.text-right(width="30%")!="ID"
        td!=global.__("Brand")
          !=" | "
          button.btn.btn-sm.btn-primary(type='button', data-toggle='modal', data-target='#modalAddPartner', data-id=owner)="ADD"

    tbody
      if data.length
        each item, index in data
          if item.stagename == "Elastic Eye"
            each item1, index1 in item
              //- console.log("          tr\n            td!=\""+index1+"\"\n"+"            td!=item."+index1+"\n")
            each item2, index2 in item.organizationData
              //- console.log("          tr\n            td!=\""+index2+"\"\n"+"            td!=(item.organizationData."+index2+" ? item.organizationData."+index2+" : \"<span class='badge badge-danger'>MISSING</span>\")\n")
            each item3, index3 in item.organizationData.address
              //- console.log("                  !=\""+index3+": \"+(item.organizationData.address && item.organizationData.address."+index3+" ? item.organizationData.address."+index3+" : \"<span class='badge badge-danger'>MISSING</span>\")\n                  br\n")
            each item4, index4 in item.organizationData.contacts[0]
              - console.log("                  !=\""+index4+": \"+(contact."+index4+" ? contact."+index4+" : \"<span class='badge badge-danger'>MISSING</span>\")\n                  br\n")
          tr
            td!=""+(index+1)
            td
              b!=item.stagename
              !=" "
              a(href="/admin/crews/"+item._id+"/public", target="_blank")!=global.__("edit")
              !=" | "
              a.unlink(href="#", data-owner=owner, data-partner=item._id)!=global.__("unlink")
              !=" | "
              if item.members && item.members.length
                a(href="/"+item.slug, target="_blank")!=global.__("view")
              else
                .badge.badge-badge badge-danger!="EXTERNAL"
          //tr
            td!="_id"
            td!=item._id

          //tr
            td!="is_crew"
            td!=item.is_crew

          //tr
            td!="user_type"
            td!=item.user_type

          //tr
            td!="stats"
            td!=item.stats

          //tr
            td!="members"
            td!=item.members

          //tr
            td!="old_id"
            td!=item.old_id

          //tr
            td!="activity"
            td!=item.activity

          //tr
            td!="is_public"
            td!=item.is_public

          //tr
            td!="text"
            td!=item.text

          //tr
            td!="categories"
            td!=item.categories

          //tr
            td!="slug"
            td!=item.slug

          //tr
            td!="username"
            td!=item.username

          //tr
            td!="image"
            td!=item.image

          //tr
            td!="addresses"
            td!=item.addresses

          //tr
            td!="web"
            td!=item.web

          //tr
            td!="events"
            td!=item.events

          //tr
            td!="news"
            td!=item.news

          //tr
            td!="activity_as_performer"
            td!=item.activity_as_performer

          //tr
            td!="activity_as_organization"
            td!=item.activity_as_organization

          //tr
            td!="scriptupdate"
            td!=item.scriptupdate

          //tr
            td!="abouts"
            td!=item.abouts

          //tr
            td!="addresses_private"
            td!=item.addresses_private

          //tr
            td!="citizenship"
            td!=item.citizenship

          //tr
            td!="connections"
            td!=item.connections

          //tr
            td!="createdAt"
            td!=item.createdAt

          //tr
            td!="crews"
            td!=item.crews

          //tr
            td!="emails"
            td!=item.emails

          //tr
            td!="flxermigrate"
            td!=item.flxermigrate

          //tr
            td!="is_confirmed"
            td!=item.is_confirmed

          //tr
            td!="mobile"
            td!=item.mobile

          //tr
            td!="organizationData"
            td!=item.organizationData

          //tr
            td!="phone"
            td!=item.phone

          //tr
            td!="roles"
            td!=item.roles

          //tr
            td!="skype"
            td!=item.skype

          //tr
            td!="social"
            td!=item.social

          //tr
            td!="updatedAt"
            td!=item.updatedAt

          //tr
            td!="partner_owner"
            td!=item.partner_owner

          //tr
            td!="is_partner"
            td!=item.is_partner

          //tr
            td!="partner_data"
            td!=item.partner_data

          //tr
            td!="partnerships"
            td!=item.partnerships
          
          if item.organizationData

            tr
              td.text-right!="Organization name"
              td!=(item.organizationData.name ? item.organizationData.name : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization legal name"
              td!=(item.organizationData.legal_name ? item.organizationData.legal_name : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization vector logo"
              td
                if item.organizationData.logo
                  img(src="https://avnode.net"+item.organizationData.logo width="300" style="background-color:#FFF")
                  br
                  !="https://avnode.net"+item.organizationData.logo
                else 
                  !="<span class='badge badge-danger'>MISSING</span>"

            tr
              td.text-right!="Organization Web site"
              td
                if item.web && item.web[0] && item.web[0].url
                  ul
                    each web in item.web
                      li
                        a(href=web.url)=web.url
                else 
                  !="<span class='badge badge-danger'>MISSING</span>"
            tr
              td.text-right!="Organization Social Media"
              td
                if item.social && item.social[0] && item.social[0].url
                  ul
                    each web in item.social
                      li
                        a(href=web.url)=web.url
                else 
                  !="<span class='badge badge-danger'>MISSING</span>"
            tr
              td.text-right!="Organization Social Media for shares"
              td
                if item.organizationData.social_share && item.organizationData.social_share[0] && item.organizationData.social_share[0].url
                  ul
                    each web in item.organizationData.social_share
                      li
                        a(href=web.url)=web.url
                else 
                  !="<span class='badge badge-danger'>MISSING</span>"

            tr
              td.text-right!="Organization Public Email"
              td!=(item.organizationData.public_email ? item.organizationData.public_email : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization phone"
              td!=(item.organizationData.phone ? item.organizationData.phone : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right
                !="Organization description"
                br
                small!="Max length 1000 chr ("+(item.organizationData.description && item.organizationData.description.length ? item.organizationData.description.length : 0)+")"
              td!=(item.organizationData.description ? item.organizationData.description.replace(/\n/gi, "<br>") : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization foundation year"
              td!=(item.organizationData.foundation_year ? item.organizationData.foundation_year : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization address"
              td
                !="Street: "+(item.organizationData.address && item.organizationData.address.route ? item.organizationData.address.route : "<span class='badge badge-danger'>MISSING</span>")
                br

                !="Postal code: "+(item.organizationData.address && item.organizationData.address.postal_code ? item.organizationData.address.postal_code : "<span class='badge badge-danger'>MISSING</span>")
                br

                !="City: "+(item.organizationData.address && item.organizationData.address.locality ? item.organizationData.address.locality : "<span class='badge badge-danger'>MISSING</span>")
                br

                !="Region: "+(item.organizationData.address && item.organizationData.address.region ? item.organizationData.address.region : "<span class='badge badge-danger'>MISSING</span>")
                br

                !="Country: "+(item.organizationData.address && item.organizationData.address.country ? item.organizationData.address.country : "<span class='badge badge-danger'>MISSING</span>")
                //br
                  !="geometry: "+(item.organizationData.address && item.organizationData.address.geometry ? item.organizationData.address.geometry : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization VAT number"
              td!=(item.organizationData.vat_number ? item.organizationData.vat_number : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization recuperate VAT?"
              td!=(item.organizationData.recuperate_vat ? item.organizationData.recuperate_vat : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization official registration number"
              td!=(item.organizationData.official_registration_number ? item.organizationData.official_registration_number : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization PIC code"
              td!=(item.organizationData.pic ? item.organizationData.pic : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right
                !="Organization type"
                br
                small!="One of this: Art association, Art gallery, Centre for Architecture, Choir, Concert hall, Dance Company, Design/Art centre, Festival (non Audiovisual), Group of young people active in youth work, Higher education institution (tertiary level), Library, Literature Foundation, Local Public body, Multimedia association, Museum, Music Centre, National Public body, Non-governmental organisation/association/social enterprise, Opera, Orchestra, Regional Public body, Research Institute/Centre, School/Institute/Educational centre – General education (secondary level), Street art association, Theatre"
              td!=(item.organizationData.type ? item.organizationData.type : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right
                !="Organization statute"
                br
                small!="PDF FILE ONLY"
              td!=(item.organizationData.statute ? "<a href=\"https://avnode.net"+item.organizationData.statute+"\" target=\"_blank\">https://avnode.net"+item.organizationData.statute+"</a>" : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right
                !="Organization members cv"
                br
                small!="PDF FILE ONLY"
              td!=(item.organizationData.members_cv ? "<a href=\"https://avnode.net"+item.organizationData.members_cv+"\" target=\"_blank\">https://avnode.net"+item.organizationData.members_cv+"</a>" : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Summary of members cv"
              td!=(item.organizationData.summary_of_members_cv_cvs ? item.organizationData.summary_of_members_cv_cvs.replace(/\n/gi, "<br>") : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right
                !="Organization Activities report "
                br
                small!="PDF FILE ONLY"
              td!=(item.organizationData.cv ? "<a href=\"https://avnode.net"+item.organizationData.cv+"\" target=\"_blank\">https://avnode.net"+item.organizationData.cv+"</a>" : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization permanent employers number"
              td!=(item.organizationData.permanent_employers ? item.organizationData.permanent_employers : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization temporary employers number"
              td!=(item.organizationData.temporary_employers ? item.organizationData.temporary_employers : "<span class='badge badge-danger'>MISSING</span>")

            //tr
              td.text-right!="Organization relevance in the project"
              td!=(item.organizationData.relevance_in_the_project ? item.organizationData.relevance_in_the_project : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right
                !="Organization EU grants in the last 3 years"
                br
                small!="Please list the projects for which the organisation has received financial support from the EU Programme during the last three years."
                br
                small!="Programme or initiative // Reference number // Beneficiary Organisation // Title of the Project"
              
              td!=(item.organizationData.eu_grants ? item.organizationData.eu_grants : "<span class='badge badge-info'>NONE</span>")

            tr
              td.text-right!="Organization EU grants submitted in the last 3 years"
              td!=(item.organizationData.eu_grants_submitted ? item.organizationData.eu_grants_submitted : "<span class='badge badge-info'>NONE</span>")

            tr
              td.text-right!="Organization annual turnover in EURO"
              td!=(item.organizationData.annual_turnover ? item.organizationData.annual_turnover : "<span class='badge badge-danger'>MISSING</span>")

            //tr
              td.text-right!="groups"
              td!=(item.organizationData.groups ? item.organizationData.groups : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization contacts"
              td
                if item.organizationData.contacts
                  ol
                    each contact in item.organizationData.contacts
                      li
                        !="title: "+(contact.title ? contact.title : "<span class='badge badge-danger'>MISSING</span>")
                        br

                        !="name: "+(contact.name ? contact.name : "<span class='badge badge-danger'>MISSING</span>")
                        br

                        !="surname: "+(contact.surname ? contact.surname : "<span class='badge badge-danger'>MISSING</span>")
                        br

                        !="role: "+(contact.role ? contact.role : "<span class='badge badge-danger'>MISSING</span>")
                        br

                        !="email: "+(contact.email ? contact.email : "<span class='badge badge-danger'>MISSING</span>")
                        br

                        !="language: "+(contact.language ? contact.language : "<span class='badge badge-danger'>MISSING</span>")
                        br

                        !="mobile_phone: "+(contact.mobile_phone ? contact.mobile_phone : "<span class='badge badge-danger'>MISSING</span>")
                        br

                        !="skype: "+(contact.skype ? contact.skype : "<span class='badge badge-danger'>MISSING</span>")
                        br

                        !="facebook: "+(contact.facebook ? "<a href=\""+contact.facebook+"\" target=\"_blank\">"+contact.facebook+"</a>" : "<span class='badge badge-danger'>MISSING</span>")
                else 
                  !="title: "+(item.organizationData.contacts ? item.organizationData.contacts : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="name: "+(item.organizationData.contacts ? item.organizationData.contacts : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="surname: "+(item.organizationData.contacts ? item.organizationData.contacts : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="role: "+(item.organizationData.contacts ? item.organizationData.contacts : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="email: "+(item.organizationData.contacts ? item.organizationData.contacts : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="language: "+(item.organizationData.contacts ? item.organizationData.contacts : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="mobile_phone: "+(item.organizationData.contacts ? item.organizationData.contacts : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="skype: "+(item.organizationData.contacts ? item.organizationData.contacts : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="facebook: "+(item.organizationData.contacts ? item.organizationData.contacts : "<span class='badge badge-danger'>MISSING</span>")

            tr
              td.text-right!="Organization legal representative"
              td
                if item.organizationData.legal_representative
                  !="title: "+(item.organizationData.legal_representative.title ? item.organizationData.legal_representative.title : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="name: "+(item.organizationData.legal_representative.name ? item.organizationData.legal_representative.name : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="surname: "+(item.organizationData.legal_representative.surname ? item.organizationData.legal_representative.surname : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="role: "+(item.organizationData.legal_representative.role ? item.organizationData.legal_representative.role : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="email: "+(item.organizationData.legal_representative.email ? item.organizationData.legal_representative.email : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="language: "+(item.organizationData.legal_representative.language ? item.organizationData.legal_representative.language : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="mobile_phone: "+(item.organizationData.legal_representative.mobile_phone ? item.organizationData.legal_representative.mobile_phone : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="skype: "+(item.organizationData.legal_representative.skype ? item.organizationData.legal_representative.skype : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="facebook: "+(item.organizationData.legal_representative.facebook ? "<a href=\""+item.organizationData.legal_representative.facebook+"\" target=\"_blank\">"+item.organizationData.legal_representative.facebook+"</a>" : "<span class='badge badge-danger'>MISSING</span>")
                else 
                  !="title: "+(item.organizationData.legal_representative ? item.organizationData.legal_representative : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="name: "+(item.organizationData.legal_representative ? item.organizationData.legal_representative : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="surname: "+(item.organizationData.legal_representative ? item.organizationData.legal_representative : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="role: "+(item.organizationData.legal_representative ? item.organizationData.legal_representative : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="email: "+(item.organizationData.legal_representative ? item.organizationData.legal_representative : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="language: "+(item.organizationData.legal_representative ? item.organizationData.legal_representative : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="mobile_phone: "+(item.organizationData.legal_representative ? item.organizationData.legal_representative : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="skype: "+(item.organizationData.legal_representative ? item.organizationData.legal_representative : "<span class='badge badge-danger'>MISSING</span>")
                  br

                  !="facebook: "+(item.organizationData.legal_representative ? item.organizationData.legal_representative : "<span class='badge badge-danger'>MISSING</span>")

            //td
              if item.partnerships && item.partnerships.length
                - item.partnerships.sort((a,b) => (a.title > b.title) ? 1 : ((b.title > a.title) ? -1 : 0));

                each partnership in item.partnerships
                  .text-nowrap
                    a(href="/"+partnership.slug, target="_blank")!=partnership.title
                    !=" "
          //tr
                      
            td
              if item.web
                each web in item.web
                  div
                    a(href=web.url, target="_blank")!=web.url
              if item.social
                each web in item.social
                  div
                    a(href=web.url, target="_blank")!=web.url
            td
              h5
                !="Contacts"
                !=" "
                // Button trigger modal
                button.btn.btn-sm.btn-primary(type='button', data-toggle='modal', data-target='#modalAddContact', data-id=item._id, data-stagename=item.stagename)="ADD"
              if item.partner_data && item.partner_data.contacts
                each contact in item.partner_data.contacts
                  div
                    a(href="mailto:"+contact.email, target="_blank")!=contact.name+" "+contact.surname
              if item.members && item.members.length
                h5="Members"
                each contact in item.members
                  div
                    a(href="mailto:"+contact.email, target="_blank")!=contact.name+" "+contact.surname

  // Modal Add Partner
  //#modalAddPartner.modal.fade(tabindex='-1', role='dialog', aria-spanledby='modalAddPartnerspan', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        form
          input(type='hidden', name="partner_owner", value=owner)
          //input(type='hidden', name="delegate", value=user.name)
          .modal-header
            h5#modalAddPartnerspan.modal-title=global.__("Add partner")
            button.close(type='button', data-dismiss='modal', aria-span='Close')
              span(aria-hidden='true') ×
          .modal-body
            .alert.d-none
            .form-group
              span(for='formPartnerAddName')=global.__("Brand")
              input#formPartnerAddName.form-control(type='text', name="stagename", placeholder='')
            .form-group
              span(for='formPartnerAddSurname')=global.__("Web channels")
                !=" "
                small=global.__("one per line")
              textarea#formPartnerAddSurname.form-control(name="web")
            .form-group
              span(for='formPartnerAddSurname')=global.__("Social channels")
                !=" "
                small=global.__("one per line")
              textarea#formPartnerAddSurname.form-control(name="social")

          .modal-footer
            button.btn.btn-secondary(type='button', data-dismiss='modal')=global.__("Close")
            button.btn.btn-primary(type='submit')=global.__("Save")
  
  // Modal Link Partner
  //#modalLinkPartner.modal.fade(tabindex='-1', role='dialog', aria-spanledby='modalLinkPartnerspan', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        form
          input(type='hidden', name="partner_owner", value=owner)
          //input(type='hidden', name="delegate", value=user.name)
          input(type='hidden', name="id")
          .modal-header
            h5#modalAddPartnerspan.modal-title=global.__("Add partner")
            button.close(type='button', data-dismiss='modal', aria-span='Close')
              span(aria-hidden='true') ×
          .modal-body
            .alert.d-none
            .form-group
              span(for='formPartnerLinkName')=global.__("Brand")
              input#formPartnerLinkName.form-control(type='text', name="brand", placeholder='')

          .modal-footer
            button.btn.btn-secondary(type='button', data-dismiss='modal')=global.__("Close")
            button.btn.btn-primary(type='submit')=global.__("Save")

  // Modal Add Contact
  //#modalAddContact.modal.fade(tabindex='-1', role='dialog', aria-spanledby='modalAddContactspan', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        form
          .modal-header
            h5#modalAddPartnerspan.modal-title=global.__("Add contact")
            button.close(type='button', data-dismiss='modal', aria-span='Close')
              span(aria-hidden='true') ×
          .modal-body
              .form-group
                input.modal-id(type='hidden', name="crew")
                span(for='formContactAddName')=global.__("Name")
                input#formContactAddName.form-control(type='text', name="name", placeholder='')
              .form-group
                span(for='formContactAddSurname')=global.__("Surname")
                input#formContactAddSurname.form-control(type='text', name="surname", placeholder='')
              .form-group
                span(for='formContactAddEmail')=global.__("Email")
                input#formContactAddEmail.form-control(type='email', name="email", placeholder='name@example.com')
              .form-group
                span(for='formContactAddMobile')=global.__("Mobile")
                input#formContactAddMobile.form-control(type='text', name="mobile", placeholder='')
              .form-group
                span(for='formContactAddFacebook')="Facebook"
                input#formContactAddFacebook.form-control(type='text', name="facebook", placeholder='')
              .form-group
                span(for='formContactAddType')=global.__("Type")
                select#formContactAddType.form-control(name="type")
                  option=global.__("Contact")
                  option=global.__("Legal Rapresentative")

          .modal-footer
            button.btn.btn-secondary(type='button', data-dismiss='modal')=global.__("Close")
            button.btn.btn-primary(type='submit')=global.__("Save")

