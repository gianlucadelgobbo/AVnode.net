extends ../layout
block content
  .container
    .pb-3
      - var perc = parseInt((100/participateMenu.length)*(call.step+1))
      h1=global.__("Participate") + ": " + global.__("Step")+ " " + (call.step+1)
      .progress.mb-3
        .progress-bar(role="progressbar" style='width: '+perc+'%;', aria-valuenow=perc, aria-valuemin='0', aria-valuemax='100')=perc+"%"
      ul.nav.nav-pills.nav-wizard.mb-3
        each val, index in participateMenu 
          li.nav-item.mb-2
            a.nav-link(href=index>call.step ? '' : '?step='+index, class=call.step==index ? "active" : index>call.step ? "disabled" : "")
              !=(index+1)+". "
              span.d-none.d-md-inline.d-lg-inline.d-xl-inline=val.label
      if msg
        include ../partials/msg
      - if (dett.subtitle)
        //h3=Fnc.getTextFormat(dett.subtitle, config.lang, true)
      - if (!dett.organizationsettings.call_is_active)
        p=global.__("No call for proposals is active")
      - else if (!user || !user._id)
        p=global.__("To participate to the call for proposal you have to be logged in")
        a.btn.btn-primary.mr-3(href="/login/?returnTo=/events/"+dett.slug+"/participate/")=global.__("LOGIN")
        a.btn.btn-light(href="/signup?returnTo=/events/"+dett.slug+"/participate/")=global.__("REGISTER")
      - else
        form(method="post" action=canonical)
          if call.step == 2
            - var admitted = dett.organizationsettings.call.calls[call.index].admitted.map(item => {return item.name})
            h2#createContents.mb-3
              if admitted.indexOf('Workshop')!==-1 || admitted.indexOf('Lecture')!==-1 || admitted.indexOf('Project showcase')!==-1
                !="Learning"
                !=" "
                sup
                  a.btn-primary.btn-sm(href='#' data-labelfield='Learning Title' data-title='Add Learning' data-param='title' data-user=user._id data-sez='performances')=global.__("New Learning")
              else 
                !=participateMenu[call.step].label
                !=" "
                sup
                  a.btn-primary.btn-sm(href='#' data-labelfield='Performance Name' data-title='Add Performance' data-user=user._id data-param='title' data-sez='performances')=global.__("New Performance")
          else 
            h2.mb-3=participateMenu[call.step].label
          
          case participateMenu[parseInt(call.step)].slug
            when "calls"
              include participate/step_calls
            when "terms"
              include participate/step_terms
            when "performance"
              include participate/step_performance
            when "topics"
              include participate/step_topics
            when "availability"
              include participate/step_availability
            when "packages"
              include participate/step_packages
            when "summary"
              include participate/step_summary
            when "submit"
              include participate/step_submit
            default
              include participate/step_calls
          if call.step < 7 && (button!==false) 
            .text-right
              input.btn.btn-lg.btn-primary(type="submit" value=global.__("NEXT")+" >>")
              input(type="hidden" name="step" value=call.step)
