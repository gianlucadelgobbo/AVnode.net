var goto=0,oldgoto=0,dates=[],playlist=[],day=new Date;$(document).ready((function(){if($("#vjtv").length){console.log("vjtv"),$("#vjtv_modal").modal({backdrop:"static",keyboard:!1});$(window).resize((function(){$(".playlist").height($("#my-video video").height()-58)}));var e=videojs("my-video",{controls:!0},(function(){videojs.log("Your player is ready!"),$(".playlist").height($("#my-video video").height()-58),$(".vjs-big-play-button").hide(),this.on("ended",(function(){videojs.log("Awww...over so soon?!"),goto+1==playlist.length&&(day.setDate(day.getDate()+1),console.log(day),t()),videojs.log(goto),videojs.log(playlist.length)}))}));function t(){var t=day.getFullYear()+"-"+("0"+(day.getMonth()+1)).slice(-2)+"-"+("0"+day.getDate()).slice(-2);$("#vjtv #date").html(day.toDateString()),-1===dates.indexOf(t)?alert("No programming for this date!!!"):($("#vjtv .playlist").html('<div class="vjs-waiting"><div class="vjs-loading-spinner"></div></div>'),$.ajax({url:"https://avnode.net/api/getprograms",method:"get",data:{day:t}}).done((function(t){$("#loadingplay span").html("Building interface");var r=t.map((e=>new Date(e.programming).getTime())),i=new Date,n=i.getTime()-60*i.getTimezoneOffset()*1e3;if(n>=r[0]&&n<r[r.length-1]){var a=r.reduce((function(e,t){return Math.abs(t-n)<Math.abs(e-n)?t:e}));oldgoto=r.indexOf(a),goto=r.indexOf(a)}else oldgoto=goto=0;console.log(new Date(r[goto]));var o='<ul class="list-unstyled">';playlist=[];for(var l=0;l<t.length;l++){t[l].video&&t[l].video.media&&t[l].video.media.file&&playlist.push({sources:[{src:"https://avnode.net"+t[l].video.media.file,type:"video/mp4"}],poster:t[l].video.imageFormats.small});var s=new Date(t[l].programming).getTime(),d=new Date(t[l].programming);o+='<li class="playlist-item bg-dark mb-3" id="P'+l+'">',o+='  <div class="row text-monospace small playlist-header" id="'+s+'">',o+='    <div class="col" id="'+t[l].programming+'"><div class="pl-2">'+d.getUTCFullYear()+"-"+("0"+(d.getUTCMonth()+1)).slice(-2)+"-"+("0"+d.getUTCDate()).slice(-2)+"<br />"+("0"+d.getUTCHours()).slice(-2)+":"+("0"+d.getUTCMinutes()).slice(-2)+":"+("0"+d.getUTCSeconds()).slice(-2)+"</div></div>",o+='    <div class="col"><div class="pr-2 text-right">'+t[l].category.name+"<br />"+t[l].video.media.durationHR+"</div></div>",o+="  </div>",o+='  <div class="media p-2" id="P'+l+'">',o+='    <img class="mr-3" style="width:100px" src="'+t[l].video.imageFormats.small+'">',o+='    <div class="media-body">',o+='      <h5 class="mt-0 mb-1">'+t[l].video.title+"</h5>",o+='      <ul class="list-inline small">'+t[l].video.users.map((e=>"<li>"+e.stagename+"</li>"))+"</ul>",o+="    </div>",o+="  </div>",o+='   <div class="more p-2"><a href="https://avnode.net/videos/'+t[l].video.slug+'/" class="badge badge-primary">MORE</a></div>',o+="</li>"}o+="</ul>",e.playlist(playlist,goto),e.on("playlistitem",(t=>{oldgoto=goto,goto=e.playlist.currentItem(),u()})),e.playlist.autoadvance(0),$("#loadingplay i").hide(),$("#loadingplay span").html("SWITCH ON TV!!!"),$("#loadingplay").removeClass("disabled"),$("#loadingplay").on("click",(function(t){e.play()})),$("#vjtv .playlist").height($("#my-video video").height()-58),$("#vjtv .playlist").html(o),$(".vjs-big-play-button").show();var u=()=>{$("#P"+oldgoto).addClass("bg-dark"),$("#P"+oldgoto).removeClass("bg-danger"),$("#P"+goto).removeClass("bg-dark"),$("#P"+goto).addClass("bg-danger"),$("#vjtv .playlist").imagesLoaded((()=>{$("#vjtv .playlist").animate({scrollTop:$("#P"+goto).position().top},2e3)})),oldgoto=goto};$(".playlist-item").click((function(t){e.playlist.currentItem(parseInt($(this).attr("id").substring(1)))}))})).fail((function(e){$("#vjtv .playlist").html("error")})))}e.logo({image:"https://vjtelevision.com/vjtelevision/images/VJTV_4x_white.svg",url:"https://vjtelevision.com",height:50,offsetH:20,offsetV:20,position:"top-left",width:150}),$("#vjtv #date").html(day.toDateString()),$.ajax({url:"https://avnode.net/api/getprogramsdays",method:"get"}).done((function(e){dates=e,t()})).fail((function(e){$("#vjtv .playlist").html("error")})),$("#vjtv #datepicker").datepicker({dateFormat:"yy-mm-dd",beforeShow:function(e,t){var r=e.getBoundingClientRect();setTimeout((function(){t.dpDiv.css({top:r.top+40})}),0)},beforeShowDay:function(e){for(var t=0;t<dates.length;t++)if(new Date(dates[t].replace("-","/").replace("-","/")).toString()==e.toString())return[!0,"highlight"];return[!0,""]}}),$("#vjtv #datepicker").change((function(){day=new Date($("#vjtv #datepicker").datepicker("getDate")),t()})),$("#vjtv #datepickerbutton").click((function(e){e.preventDefault();var t=$("#vjtv #datepicker").datepicker("widget").is(":visible");$("#vjtv #datepicker").datepicker(t?"hide":"show")}))}})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e=e||self).videojsPlaylist=t(e.videojs)}(this,(function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t=function(e){var t=e.playlist.autoadvance_;t.timeout&&e.clearTimeout(t.timeout),t.trigger&&e.off("ended",t.trigger),t.timeout=null,t.trigger=null},r=function e(r,i){t(r),function(e){return"number"==typeof e&&!isNaN(e)&&0<=e&&e<1/0}(i)?(r.playlist.autoadvance_.delay=i,r.playlist.autoadvance_.trigger=function(){var n=function(){return e(r,i)};r.one("play",n),r.playlist.autoadvance_.timeout=r.setTimeout((function(){t(r),r.off("play",n),r.playlist.next()}),1e3*i)},r.one("ended",r.playlist.autoadvance_.trigger)):r.playlist.autoadvance_.delay=null},i=function(e){return!!e&&"object"==typeof e},n=function(e,t){var r=e,i=t;return"object"==typeof e&&(r=e.src),"object"==typeof t&&(i=t.src),/^\/\//.test(r)&&(i=i.slice(i.indexOf("//"))),/^\/\//.test(i)&&(r=r.slice(r.indexOf("//"))),r===i},a=function(e,t){for(var r=0;r<e.length;r++){var i=e[r].sources;if(Array.isArray(i))for(var a=0;a<i.length;a++){var o=i[a];if(o&&n(o,t))return r}}return-1};var o=function(n,o){!function(n,o,l){void 0===l&&(l=0);var s=null,d=!1,u=n.playlist=function(e,t){if(void 0===t&&(t=0),d)throw new Error("do not call playlist() during a playlist change");if(Array.isArray(e)){var r=Array.isArray(s)?s.slice():null,a=e.slice();(s=a.slice()).filter((function(e){return i(e)})).length!==s.length&&(s=function(e){var t,r=[];return e.forEach((function(e){i(e)?t=e:(t=Object(e)).originalValue=e,r.push(t)})),r}(s)),function(e){var t=1;e.forEach((function(e){e.playlistItemId_=t++}))}(s),d=!0,n.trigger({type:"duringplaylistchange",nextIndex:t,nextPlaylist:a,previousIndex:u.currentIndex_,previousPlaylist:r||[]}),d=!1,-1!==t&&u.currentItem(t),r&&n.setTimeout((function(){n.trigger("playlistchange")}),0)}return s.map((function(e){return e.originalValue||e})).slice()};n.on("loadstart",(function(){-1===u.currentItem()&&t(n)})),u.currentIndex_=-1,u.player_=n,u.autoadvance_={},u.repeat_=!1,u.currentPlaylistItemId_=null,u.currentItem=function(e){if(d)return u.currentIndex_;if("number"==typeof e&&u.currentIndex_!==e&&0<=e&&e<s.length)return u.currentIndex_=e,function(e,t){var i=!e.paused()||e.ended();e.trigger("beforeplaylistitem",t.originalValue||t),t.playlistItemId_&&(e.playlist.currentPlaylistItemId_=t.playlistItemId_),e.poster(t.poster||""),e.src(t.sources),function(e){for(var t=e.remoteTextTracks(),r=t&&t.length||0;r--;)e.removeRemoteTextTrack(t[r])}(e),e.ready((function(){if((t.textTracks||[]).forEach(e.addRemoteTextTrack.bind(e)),e.trigger("playlistitem",t.originalValue||t),i){var n=e.play();void 0!==n&&"function"==typeof n.then&&n.then(null,(function(e){}))}r(e,e.playlist.autoadvance_.delay)}))}(u.player_,s[u.currentIndex_]),u.currentIndex_;var t=u.player_.currentSrc()||"";if(u.currentPlaylistItemId_){var i=function(e,t){for(var r=0;r<e.length;r++)if(e[r].playlistItemId_===t)return r;return-1}(s,u.currentPlaylistItemId_),n=s[i];if(n&&Array.isArray(n.sources)&&-1<a([n],t))return u.currentIndex_=i,u.currentIndex_;u.currentPlaylistItemId_=null}return u.currentIndex_=u.indexOf(t),u.currentIndex_},u.contains=function(e){return-1!==u.indexOf(e)},u.indexOf=function(e){if("string"==typeof e)return a(s,e);for(var t=Array.isArray(e)?e:e.sources,r=0;r<t.length;r++){var i=t[r];if("string"==typeof i)return a(s,i);if(i.src)return a(s,i.src)}return-1},u.currentIndex=function(){return u.currentItem()},u.lastIndex=function(){return s.length-1},u.nextIndex=function(){var e=u.currentItem();if(-1===e)return-1;var t=u.lastIndex();return u.repeat_&&e===t?0:Math.min(e+1,t)},u.previousIndex=function(){var e=u.currentItem();return-1===e?-1:u.repeat_&&0===e?u.lastIndex():Math.max(e-1,0)},u.first=function(){if(!d){var e=u.currentItem(0);if(s.length)return s[e].originalValue||s[e];u.currentIndex_=-1}},u.last=function(){if(!d){var e=u.currentItem(u.lastIndex());if(s.length)return s[e].originalValue||s[e];u.currentIndex_=-1}},u.next=function(){if(!d){var e=u.nextIndex();if(e!==u.currentIndex_){var t=u.currentItem(e);return s[t].originalValue||s[t]}}},u.previous=function(){if(!d){var e=u.previousIndex();if(e!==u.currentIndex_){var t=u.currentItem(e);return s[t].originalValue||s[t]}}},u.autoadvance=function(e){r(u.player_,e)},u.repeat=function(t){return void 0===t?u.repeat_:"boolean"==typeof t?(u.repeat_=!!t,u.repeat_):void e.log.error("videojs-playlist: Invalid value for repeat",t)},u.sort=function(e){s.length&&(s.sort(e),d||n.trigger("playlistsorted"))},u.reverse=function(){s.length&&(s.reverse(),d||n.trigger("playlistsorted"))},u.shuffle=function(e){var t,r=(void 0===e?{}:e).rest,i=0,a=s;r&&(i=u.currentIndex_+1,a=s.slice(i)),a.length<=1||(function(e){for(var t=-1,r=e.length-1;++t<e.length;){var i=t+Math.floor(Math.random()*(r-t+1)),n=e[i];e[i]=e[t],e[t]=n}}(a),r&&(t=s).splice.apply(t,[i,a.length].concat(a)),d||n.trigger("playlistsorted"))},Array.isArray(o)?u(o.slice(),l):s=[]}(this,n,o)};return(e.registerPlugin||e.plugin)("playlist",o),o.VERSION="4.3.1",o}));